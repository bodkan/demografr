#!/usr/bin/env python3
import argparse

import allel
import pandas as pd

# vcf_path = "/project/genotypes.vcf"
# tsv_path = "/project/diversity.tsv"
# vcf_path = r["vcf"]

parser = argparse.ArgumentParser()
parser.add_argument("--vcf", type=str, required=True)
parser.add_argument("--tsv", type=str, required=True)

args = parser.parse_args()
vcf_path = args.vcf
tsv_path = args.tsv

vcf = allel.read_vcf(vcf_path)

# convert GenotypeArray to HaplotypeArray to work on "phased chromosomes""
# like we do with the tskit-based summary statistic
gt = allel.GenotypeArray(vcf["calldata/GT"])
pos = vcf["variants/POS"]
ac = gt.count_alleles()

pi1 = allel.sequence_diversity(pos, ac)

gt = gt.to_haplotypes()
pos = vcf["variants/POS"]
ac = gt.count_alleles()
pi2 = allel.sequence_diversity(pos, ac)

df = pd.DataFrame({"set": ["pop", "pop"], "diversity": [pi1, pi2]})

df.to_csv(tsv_path, sep="\t", index=False)
