<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Specifying prior distributions • demografr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specifying prior distributions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">demografr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-question-circle"></span> Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vignette-01-basics.html">A basic ABC workflow</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-02-priors.html">Specifying prior distributions</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-03-grids.html">Support for grid simulations</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-04-parallelization.html">Parallelization options</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-05-custom.html">Custom inference using SLiM or Python</a></li>
    <li><a class="dropdown-item" href="../articles/vignette-06-diagnostics.html">Model selection and other diagnostics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bodkan/demografr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Specifying prior distributions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bodkan/demografr/blob/HEAD/vignettes/vignette-02-priors.Rmd" class="external-link"><code>vignettes/vignette-02-priors.Rmd</code></a></small>
      <div class="d-none name"><code>vignette-02-priors.Rmd</code></div>
    </div>

    
    
<p>⚠️⚠️⚠️</p>
<p><strong>Please note that until a peer reviewed publication describing
the <em>demografr</em> package is published, the software should be
regarded as experimental and potentially unstable.</strong></p>
<p>⚠️️⚠️⚠️</p>
<p>In order to perform probabilistic inference using a method such as
Approximate Bayesian Computation, we need a way to specify prior
distributions of parameters.</p>
<p>Different frameworks and languages approach this from different
angles. This vignette describes a method used by <em>demografr</em>.
<strong>The description provided here is quite detailed and
technical.</strong> Unless you’re very curious about metaprogramming
tricks provided by the R language, you’re very unlikely to need
this.</p>
<p>Imagine the following probabilistic statements. Which features does
<em>demografr</em> provide to encode them in an R script?</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>e</mi></msub><mo>∼</mo><mi>U</mi><mi>n</mi><mi>i</mi><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mn>1000</mn><mo>,</mo><mn>10000</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">N_e \sim Unif(1000, 10000)</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">geneflow</mtext><mo>∼</mo><mi>U</mi><mi>n</mi><mi>i</mi><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\textrm{geneflow} \sim Unif(0, 1)</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>T</mi><mtext mathvariant="normal">split</mtext><mi>i</mi></msubsup><mo>∼</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy="false" form="prefix">(</mo><mn>10</mn><mo>,</mo><mn>10000</mn><mo stretchy="false" form="postfix">)</mo><mo>,</mo><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><mi>i</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mn>5</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">T_{\textrm{split}}^i \sim Norm(10, 10000), \textrm{for } i \in \{1, 2, ..., 5\}</annotation></semantics></math></p>
<p><strong>If you don’t care about technical details of
<em>demografr</em> internals, feel free to jump <a href="#final-result">here</a>.</strong></p>
<div class="section level2">
<h2 id="one-trivial-option">One trivial option<a class="anchor" aria-label="anchor" href="#one-trivial-option"></a>
</h2>
<p>Possibly the most trivial solution to this problem in R would be to
write something like the following. Indeed, some probabilistic inference
R packages do exactly that:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Ne"</span>, <span class="st">"runif"</span>, <span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"geneflow"</span>, <span class="st">"runif"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="co"># (not sure how would one create a vector like T_i)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In Python, you might write object-oriented code like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> tensorflow_probability <span class="im">as</span> tfp</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># define random variables</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>Ne <span class="op">=</span> tfp.distributions.Uniform(low<span class="op">=</span><span class="fl">1000.</span>, high<span class="op">=</span><span class="fl">10000.</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>geneflow <span class="op">=</span> tfp.distributions.Uniform(low<span class="op">=</span><span class="fl">0.</span>, high<span class="op">=</span><span class="fl">1.</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>T_split <span class="op">=</span> tfp.distributions.Uniform(low<span class="op">=</span><span class="fl">10.</span>, high<span class="op">=</span><span class="fl">10000.</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co"># sample from the distributions</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>Ne_sample <span class="op">=</span> Ne.sample()</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>geneflow_sample <span class="op">=</span> geneflow.sample()</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>T_split_sample <span class="op">=</span> T_split.sample(<span class="dv">5</span>)</span></code></pre></div>
<p>The question I asked as I began drafting the design of
<em>demografr</em> was whether it would be possible to do this more
“elegantly”—with less code and closer to actual mathematical
notation.</p>
</div>
<div class="section level2">
<h2 id="fancier-metaprogramming-solution">Fancier metaprogramming solution<a class="anchor" aria-label="anchor" href="#fancier-metaprogramming-solution"></a>
</h2>
<p>Despite being <em>“a silly calculator language”</em> (quote by a
former colleague of mine), R is a very powerful functional programming
language with advanced <a href="https://en.wikipedia.org/wiki/Metaprogramming" class="external-link">metaprogramming</a>
options. To paraphrase information from Wikipedia:</p>
<blockquote>
<p>Metaprogramming is a <strong>programming technique in which computer
programs have the ability to treat other programs as their
data</strong>. It means that a program can be designed to read,
generate, analyze or transform other programs, and even modify itself
while running.</p>
<p>In other words, <strong>metaprogramming is when code is writing other
code.</strong></p>
</blockquote>
<p>What does this mean in practice in R? You might be familiar with the
syntax for fitting linear models in R:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">cyl</span> <span class="op">~</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = cyl ~ mpg, data = mtcars)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)          mpg  </span></span>
<span><span class="co">#&gt;     11.2607      -0.2525</span></span></code></pre>
<p>The <strong><code>~</code> operator creates a so-called “formula
object”</strong>, which captures the expression provided by the user
(relationship between columns of the data frame, <code>"cyl"</code> and
<code>"mpg"</code>), and can then be manipulated or interpreted by the
function that the formula is passed to.</p>
<p>Importantly, if you type <code>cyl ~ mpg</code> into your R console,
you get the same thing back. It doesn’t do anything by itself! In fact,
if you were to type <code>cyl</code> or <code>mpg</code> into your R
console on their own, you would get an error.</p>
<p>However, when you execute the <code>lm</code> command above, the
function uses R’s metaprogramming features to interpret the information
in the formula to extract appropriate information (column vectors
<code>"cyl"</code> and <code>"mpg"</code>) from the data frame, and
perform the necessary computation for the linear regression fit. In this
context, one could also say that the formula syntax provides a <a href="https://en.wikipedia.org/wiki/Domain-specific_language" class="external-link">domain-specific
language</a> for encoding statistical modeling equations in R.</p>
<p>Our goal in <em>demografr</em>, then, is to provide a similar
functionality for encoding prior sampling statements.</p>
</div>
<div class="section level2">
<h2 id="how-to-use-this-for-the-problem-above">How to use this for the problem above?<a class="anchor" aria-label="anchor" href="#how-to-use-this-for-the-problem-above"></a>
</h2>
<p>Imagine then that we want to write an R interface for doing something
like this:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>e</mi></msub><mo>∼</mo><mi>U</mi><mi>n</mi><mi>i</mi><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mn>1000</mn><mo>,</mo><mn>10000</mn><mo stretchy="false" form="postfix">)</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">N_e \sim Unif(1000, 10000).</annotation></semantics></math></p>
<p>Obviously, we have functions such as <code>runif</code>,
<code>rnorm</code>, etc., which generate a number from a
distribution:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="fl">1000</span>, max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 9233.254</span></span></code></pre>
<p>We can also do this in R, “for free”, without doing anything
else.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="va">Ne</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Ne ~ runif(1000, 10000)</span></span></code></pre>
<p><strong>Note that this expression is not evaluated! Formula is simply
an object carrying a bit of syntax.</strong> Just as we demonstrated
above in the discussion of formula used in an <code>lm</code> call,
simply entering <code>Ne ~ runif(1000, 10000)</code> into the R console
doesn’t do anything on its own.</p>
<p>This is important, because the <code>runif(1000, 10000)</code> on the
right is not a valid R code.</p>
<p><strong>This is called <a href="https://en.wikipedia.org/wiki/Lazy_evaluation" class="external-link">lazy
evaluation</a>.</strong> R does not evaluate something at the time
unless it’s “needed” at that time. The opposite to this is “eager
evaluation” done by something like Python or C.</p>
</div>
<div class="section level2">
<h2 id="metaprogramming-in-r-in-practice">Metaprogramming in R in practice<a class="anchor" aria-label="anchor" href="#metaprogramming-in-r-in-practice"></a>
</h2>
<p>Metaprogramming is often magic requiring lots of complicated tools,
but to do very basic metaprogramming in R is very simple.</p>
<p>How can we “manipulate” code and give it our own meaning?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Ne ~ runif(1000, 10000)</span></span></code></pre>
<p>When given a formula, the R function <strong><code>as.list</code>
parses the language expression into smallest possible “atomic
pieces”</strong>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; `~`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; Ne</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; runif(1000, 10000)</span></span></code></pre>
<p>This is called an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" class="external-link">abstract
syntax tree</a> in programming language design.</p>
<p>Note that this works generally for any language expression (even
those that are much deeper):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">c</span> <span class="op">-</span> <span class="va">d</span> <span class="op">/</span> <span class="va">e</span><span class="op">)</span></span></code></pre></div>
<p>Although fut for expressions like the above it is easier to use a
proper metaprogramming tool such as the function <code>ast</code>
provided by the R package <a href="https://lobstr.r-lib.org" class="external-link"><em>lobstr</em></a>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/ast.html" class="external-link">ast</a></span><span class="op">(</span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">c</span> <span class="op">-</span> <span class="va">d</span> <span class="op">/</span> <span class="va">e</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #FFAF00;">█</span>─<span style="color: #BB00BB; font-weight: bold;">`*`</span> </span></span>
<span><span class="co">#&gt; ├─<span style="color: #FFAF00;">█</span>─<span style="color: #BB00BB; font-weight: bold;">`(`</span> </span></span>
<span><span class="co">#&gt; │ └─<span style="color: #FFAF00;">█</span>─<span style="color: #BB00BB; font-weight: bold;">`+`</span> </span></span>
<span><span class="co">#&gt; │   ├─<span style="color: #BB00BB; font-weight: bold;">a</span> </span></span>
<span><span class="co">#&gt; │   └─<span style="color: #BB00BB; font-weight: bold;">b</span> </span></span>
<span><span class="co">#&gt; └─<span style="color: #FFAF00;">█</span>─<span style="color: #BB00BB; font-weight: bold;">`(`</span> </span></span>
<span><span class="co">#&gt;   └─<span style="color: #FFAF00;">█</span>─<span style="color: #BB00BB; font-weight: bold;">`-`</span> </span></span>
<span><span class="co">#&gt;     ├─<span style="color: #BB00BB; font-weight: bold;">c</span> </span></span>
<span><span class="co">#&gt;     └─<span style="color: #FFAF00;">█</span>─<span style="color: #BB00BB; font-weight: bold;">`/`</span> </span></span>
<span><span class="co">#&gt;       ├─<span style="color: #BB00BB; font-weight: bold;">d</span> </span></span>
<span><span class="co">#&gt;       └─<span style="color: #BB00BB; font-weight: bold;">e</span></span></span></code></pre>
<p>Even if you haven’t heard about AST before, if you look closely at
the result above, you will notice that it captures the same expression
as <code>(a + b) * (c - d / e)</code> except that it dissassembled it
into smallest possible atomic pieces and decomposed it via so-called <a href="https://en.wikipedia.org/wiki/Polish_notation" class="external-link">prefix
notation</a>. This is a standard representation of AST data structure
(in fact, the simpler version we obtained via <code>as.list</code> above
does the same thing).</p>
</div>
<div class="section level2">
<h2 id="back-to-demografr">Back to <em>demografr</em><a class="anchor" aria-label="anchor" href="#back-to-demografr"></a>
</h2>
<p>Let’s now return to our original goal of encoding prior sampling
statements such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">variable</mtext><mo>∼</mo><mtext mathvariant="normal">distribution</mtext></mrow><annotation encoding="application/x-tex">\textrm{variable} \sim \textrm{distribution}</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Ne ~ runif(1000, 10000)</span></span></code></pre>
<p>which we can parse like this:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; `~`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; Ne</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; runif(1000, 10000)</span></span></code></pre>
<p>And which we hope to interpret in a way that’s compatible with
something like
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>e</mi></msub><mo>∼</mo><mi>U</mi><mi>n</mi><mi>i</mi><mi>f</mi><mo stretchy="false" form="prefix">(</mo><mn>1000</mn><mo>,</mo><mn>10000</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">N_e \sim Unif(1000, 10000)</annotation></semantics></math>.</p>
<p><em>demografr</em> implements a way to parse each such prior sampling
statement, and automatically convert the “invalid” expression:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ne</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<p>into a proper R statement</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, min <span class="op">=</span> <span class="fl">1000</span>, max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<p>This is then used during the ABC simulation process.</p>
<div class="section level3">
<h3 id="sample_prior-function">
<code>sample_prior()</code> function<a class="anchor" aria-label="anchor" href="#sample_prior-function"></a>
</h3>
<p>The above feature of <em>demografr</em> is implemented by a function
<code>sample_prior</code>. Although this function is exported to the
user space in your R console, you shouldn’t need to use it for any of
your work besides simple debugging of your priors:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bodkan/demografr" class="external-link">demografr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sample_prior.html">sample_prior</a></span><span class="op">(</span><span class="va">Ne</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $variable</span></span>
<span><span class="co">#&gt; [1] "Ne"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 9433.679</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sample_prior.html">sample_prior</a></span><span class="op">(</span><span class="va">Ne</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $variable</span></span>
<span><span class="co">#&gt; [1] "Ne"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 3575.256</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sample_prior.html">sample_prior</a></span><span class="op">(</span><span class="va">Ne</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $variable</span></span>
<span><span class="co">#&gt; [1] "Ne"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 8474.029</span></span></code></pre>
<p>This function takes in a formula statement (our DLS for encoding
prior sampling events), parses it into individual components, and
simulates a value of a random variable from a provided distribution
function.</p>
</div>
</div>
<div class="section level2">
<h2 id="sampling-random-vectors">Sampling random vectors<a class="anchor" aria-label="anchor" href="#sampling-random-vectors"></a>
</h2>
<p>To provide support for random vectors, <em>demografr</em> uses a
similar metaprogramming trick as above.</p>
<p>Imagine this syntax for vectorized statements (the
<code>T_split[5]</code> is <em>demografr</em>’s made up syntax, not R
syntax!):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="va">T_split</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; `~`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; T_split[5]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; runif(10, 10000)</span></span></code></pre>
<p>Note that this expression is one layer “deeper” than would be with a
plain <code>T_split ~ runif(10, 10000)</code>.</p>
<p>This means that for “vector variables” of <em>demografr</em>, we need
to take care of the nesting:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">variable</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; T_split[5]</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; `[`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; T_split</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre>
<div class="section level3">
<h3 id="in-demografr-then">In <em>demografr</em> then…<a class="anchor" aria-label="anchor" href="#in-demografr-then"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sample_prior.html">sample_prior</a></span><span class="op">(</span><span class="va">T_split</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $variable</span></span>
<span><span class="co">#&gt; [1] "T_split"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 6421.038 5195.769 7368.517 1355.319 6573.353</span></span></code></pre>
<p>Which internally turns the prior expression into
<code>runif(n = 10, min = 10, max = 10000)</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="final-result">Final list of all priors<a class="anchor" aria-label="anchor" href="#final-result"></a>
</h2>
<p>In conclusion, using <em>demografr</em>’s features it’s possible to
define the example prior sampling statements from the top of this
vignette in R code like this:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">Ne</span>         <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span><span class="op">)</span>,</span>
<span>  <span class="va">geneflow</span>   <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">T_split</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  <span class="va">truth</span>      <span class="op">~</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Take home messages:</strong></p>
<ul>
<li><p>All of this is <em>declarative</em>! The R code defines the
priors, but doesn’t sample any numbers!</p></li>
<li><p>The exact process of metaprogramming that accomplishes this is
something you don’t ever have to worry or care about as a user.</p></li>
<li><p>All of the processing and sampling from priors is done internally
(and automatically) by <em>demografr</em> while running simulation
replicates for ABC, etc., like this:</p></li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">simulate_abc</span>(model, <span class="sc">&lt;</span>priors<span class="sc">&gt;</span>, functions, observed, ...)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="addendum">Addendum<a class="anchor" aria-label="anchor" href="#addendum"></a>
</h2>
</div>
<div class="section level2">
<h2 id="prior-parameter-templates">Prior parameter templates<a class="anchor" aria-label="anchor" href="#prior-parameter-templates"></a>
</h2>
<p>Imagine we have the following <em>slendr</em> model function
(hilariously overcomplicated, purely for demonstration purposes!):</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bodkan/slendr" class="external-link">slendr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/slendr/man/init_env.html" class="external-link">init_env</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">T_a1</span>, <span class="va">T_a2</span>, <span class="va">T_a3</span>, <span class="va">T_a4</span>, <span class="va">T_a5</span>, <span class="va">T_b1</span>, <span class="va">T_b2</span>, <span class="va">T_b3</span>, <span class="va">T_b4</span>, <span class="va">T_b5</span>, <span class="va">N_a</span>, <span class="va">N_b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"a1"</span>, time <span class="op">=</span> <span class="va">T_a1</span>, N <span class="op">=</span> <span class="va">N_a</span><span class="op">)</span></span>
<span>  <span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"a2"</span>, time <span class="op">=</span> <span class="va">T_a2</span>, N <span class="op">=</span> <span class="va">N_a</span>, parent <span class="op">=</span> <span class="va">a1</span><span class="op">)</span></span>
<span>  <span class="va">a3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"a3"</span>, time <span class="op">=</span> <span class="va">T_a3</span>, N <span class="op">=</span> <span class="va">N_a</span>, parent <span class="op">=</span> <span class="va">a1</span><span class="op">)</span></span>
<span>  <span class="va">a4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"a4"</span>, time <span class="op">=</span> <span class="va">T_a4</span>, N <span class="op">=</span> <span class="va">N_a</span>, parent <span class="op">=</span> <span class="va">a1</span><span class="op">)</span></span>
<span>  <span class="va">a5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"a5"</span>, time <span class="op">=</span> <span class="va">T_a5</span>, N <span class="op">=</span> <span class="va">N_a</span>, parent <span class="op">=</span> <span class="va">a1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"b1"</span>, time <span class="op">=</span> <span class="va">T_b1</span>, N <span class="op">=</span> <span class="va">N_b</span>, parent <span class="op">=</span> <span class="va">a1</span><span class="op">)</span></span>
<span>  <span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"b2"</span>, time <span class="op">=</span> <span class="va">T_b2</span>, N <span class="op">=</span> <span class="va">N_b</span>, parent <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span>  <span class="va">b3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"b3"</span>, time <span class="op">=</span> <span class="va">T_b3</span>, N <span class="op">=</span> <span class="va">N_b</span>, parent <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span>  <span class="va">b4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"b4"</span>, time <span class="op">=</span> <span class="va">T_b4</span>, N <span class="op">=</span> <span class="va">N_b</span>, parent <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span>  <span class="va">b5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/population.html" class="external-link">population</a></span><span class="op">(</span><span class="st">"b5"</span>, time <span class="op">=</span> <span class="va">T_b5</span>, N <span class="op">=</span> <span class="va">N_b</span>, parent <span class="op">=</span> <span class="va">b1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/slendr/man/compile_model.html" class="external-link">compile_model</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">a1</span>, <span class="va">a2</span>, <span class="va">a3</span>, <span class="va">a4</span>, <span class="va">a5</span>, <span class="va">b1</span>, <span class="va">b2</span>, <span class="va">b3</span>, <span class="va">b4</span>, <span class="va">b5</span><span class="op">)</span>,</span>
<span>    generation_time <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This functions has a huge number of parameters, so if we were to
specify them with the normal DSL described above for the purposes of ABC
inference, we would have to write down the following monstrosity:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">individual_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">T_a1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_a2</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_a3</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_a4</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_a5</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_b1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_b2</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_b3</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_b4</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_b5</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="va">N_a</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  <span class="va">N_b</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">7000</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The second possibility would be to re-parametrize the function to
accept, for instance, two pairs of two vectors of <code>T</code> and
<code>N</code>, one for each population. However, we can also use
<em>demografr</em>’s support for <strong>‘templated’ prior sampling
expressions</strong> (for a lack of a better word). The easiest way to
explain this is just to write it down:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">templated_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">T_a...</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>,     <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">T_b...</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  <span class="va">N_a</span>    <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>,    <span class="fl">3000</span><span class="op">)</span>,</span>
<span>  <span class="va">N_b</span>    <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>,  <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When priors like this are plugged in to either
<code><a href="../reference/simulate_abc.html">simulate_abc()</a></code> or <code><a href="../reference/simulate_model.html">simulate_model()</a></code>,
<em>demografr</em> tries to <strong>match model function arguments
against the prior names (here, <code>T_a...</code> and
<code>T_b...</code>), assigning each model function argument (i.e.,
model parameter) to an appropriate prior sampling expression by
substituting the <code>...</code> on the left hand of each prior
sampling statement</strong>.</p>
<p>You can read <code>T_a... ~ &lt;distribution&gt;</code> as “sample
any parameter starting with ‘T_a’ from
<code>&lt;distribution&gt;</code>.</p>
<p>This way, when defining prior sampling expressions, you’re not
hindered by the complexity of your model function (having to handle
vector indexing as you’d have to with vectorized prior sampling
statements).</p>
<p><em>demografr</em> also provides means to visualize the entire prior
distribution using numbers sampled from each. This can be helpful to
check a previously defined prior sampling statements for correctnes:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_prior.html">plot_prior</a></span><span class="op">(</span><span class="va">individual_priors</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-02-priors_files/figure-html/prior_facet_plot1-1.png" class="r-plt" width="420"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_prior.html">plot_prior</a></span><span class="op">(</span><span class="va">individual_priors</span>, facets <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-02-priors_files/figure-html/prior_facet_plot2-1.png" class="r-plt" width="420"></p>
<div class="section level3">
<h3 id="custom-functions">Custom functions<a class="anchor" aria-label="anchor" href="#custom-functions"></a>
</h3>
<p>The DSL for specification of parameter priors also allows
custom-defined prior distribution functions, not just built-in
<code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif()</a></code>, <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm()</a></code>, etc.</p>
<p>For instance, imagine this function simulating a sampling from a
distribution of a loaded casino die, <code>rcasino()</code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcasino</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">outcomes</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span> <span class="co"># six sides of a die</span></span>
<span>  <span class="va">probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># rolling a 6 is 3x more likely!</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">outcomes</span>, size <span class="op">=</span> <span class="va">n</span>, prob <span class="op">=</span> <span class="va">probabilities</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can use our custom function in exactly the same way as standard R
sampling functions. First, we define a prior for sampling a parameter
value from the loaded die casino die (actually, do demonstrate that
<code>rcasino</code> really works as it should, let’s sample a vector of
100 random die rolls):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par</span> <span class="op">&lt;-</span> <span class="va">rolls</span><span class="op">[</span><span class="fl">100</span><span class="op">]</span> <span class="op">~</span> <span class="fu">rcasino</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>During a hypothetical ABC sampling process, <em>demografr</em> would
then sample the parameter <code>par</code> (internally and
automatically) via its function <code><a href="../reference/sample_prior.html">sample_prior()</a></code>:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_prior.html">sample_prior</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="va">samples</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $variable</span></span>
<span><span class="co">#&gt; [1] "rolls"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt;   [1] 6 5 4 6 1 4 6 6 6 6 6 6 2 5 5 5 1 6 2 4 1 6 2 6 3 5 1 6 2 6 5 1 3 4 6 1 1</span></span>
<span><span class="co">#&gt;  [38] 4 1 4 3 6 6 6 3 3 4 6 6 3 4 6 3 6 1 6 5 2 6 5 2 3 6 1 2 4 6 6 3 6 6 5 6 6</span></span>
<span><span class="co">#&gt;  [75] 6 5 2 4 4 6 5 2 6 6 5 6 6 6 6 2 4 3 4 4 6 6 4 1 6 2</span></span></code></pre>
<p>Finally, we can verify that the sampled values really correspond to a
loaded die which throws a six much more often than others:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">samples</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  1  2  3  4  5  6 </span></span>
<span><span class="co">#&gt; 11 11 10 15 12 41</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Petr.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
